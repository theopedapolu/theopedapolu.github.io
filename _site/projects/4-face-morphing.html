<!DOCTYPE html>

<!--
  portfolYOU Jekyll theme by Youssef Raafat
  Free for personal and commercial use under the MIT license
  https://github.com/YoussefRaafatNasry/portfolYOU
-->

<html lang="en" class="h-100">

<head>

  
  
  

  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Face Morphing">
  <meta property="og:description" content="Fabulous is a science-based app, incubated in Duke's Behavioral Economics Lab, that will help you build healthy rituals into your life, just like an elite at...">
  <meta property="og:image" content="https://storage.googleapis.com/gd-wagtail-prod-assets/original_images/material_design_awards_inline_002.jpg">

  <title>Face Morphing</title>
  <meta name="description" content="Fabulous is a science-based app, incubated in Duke's Behavioral Economics Lab, that will help you build healthy rituals into your life, just like an elite at...">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">

  <!-- Theme style -->
  <script src="/assets/js/theme.js"></script>

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">

  <!-- Bootstrap CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">

  <!-- Animate CSS CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">

</head>


<body class="h-100 d-flex flex-column">

  <main class="flex-shrink-0 container mt-5">
    <nav class="navbar navbar-expand-lg navbar-themed">

  <a class="navbar-brand" href="/"><h5><b>Theo Pedapolu</b></h5></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-1x fa-bars text-themed"></i>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav ml-auto"><a class="nav-item nav-link active" href="/projects/">Projects</a>

      <a class="nav-item nav-link " href="/blog/">Blog</a>

      <a class="nav-item nav-link " href="/about/">About</a>

      

      <span id="theme-toggler" class="nav-item nav-link" role="button" onclick="toggleTheme()"></span>
    </div>
  </div>

</nav>
    <div class="col-lg-10 mx-auto mt-5 markdown-body">
  <h1 id="face-morphing">Face Morphing</h1>

<h3 id="background">Background</h3>

<p>In this project, I explore various applications of morphing. I morph my face into the face of Magnus Carlen, the world chess champion. Then, I use a dataset of Danish faces and compute the average face of the population, morphing the average into my face and vice versa. Finally, I use morphing to change the gender of my face for the bells &amp; whistles portion.</p>

<h3 id="part-1-defining-correspondences">Part 1: Defining Correspondences</h3>

<p>In order to morph my face into Magnus’s, I first defined correspondence points between the two images using this tool: <a href="https://inst.eecs.berkeley.edu/~cs194-26/fa22/upload/files/proj3/cs194-26-aex/tool.html">Correspondence Points Tool</a>. Then, I created a triangular mesh for the two images using Delaunay triangulation, which ensured that the triangles were not too skinny. The triangulation was constructed on the average of the two correspondence points sets to avoid triangle deformation.</p>

<p><img src="images/face_morphing/theo_nobg.png" alt="My Face" /><br />
<em>My Face</em></p>

<p><img src="images/face_morphing/magnus_nobg.png" alt="Magnus Carlsen's Face" /><br />
<em>Magnus Carlsen’s Face</em></p>

<p><img src="images/face_morphing/theo_tri.PNG" alt="Triangulation of my Face" /><br />
<em>Triangulation of my Face - Computed on average point set</em></p>

<p><img src="images/face_morphing/magnus_tri.PNG" alt="Triangulation of Magnus's Face" /><br />
<em>Triangulation of Magnus’s Face - Computed on average point set</em></p>

<h3 id="part-2-computing-the-mid-way-face">Part 2: Computing the “Mid-way Face”</h3>

<p>To get an idea of how to construct a sequence that morphs my face into Magnus’s, I computed the mid-way face first, which is the average combination of my face with Magnus’s. This is the face that should appear in the middle of the morphing sequence. From the previous part, I had the average shape (i.e., the average of the two correspondence points sets). To construct the midway face, I first warped my face into the average shape and Magnus’s face into the average shape. Then, I cross-dissolved the two warped images by averaging the pixel values between them. For the warping procedure, we want to warp each triangle in the source shape to its corresponding triangle in the target shape, so for each pair of corresponding triangles, we find the inverse affine transformation matrix that maps the target triangle to the source triangle. Then, to find the color of each pixel inside the target triangle, we apply this inverse affine transformation to find its location in the source triangle and interpolate among the source pixels to find the color of the target pixel. I used nearest neighbor interpolation because it ran the fastest and produced good results.</p>

<p><img src="images/face_morphing/theo_tri.PNG" alt="Triangulation of my face with original shape" /><br />
<em>Triangulation of my face with original shape</em></p>

<p><img src="images/face_morphing/theo_avg_tri.PNG" alt="Triangulation of my face with midway shape" /><br />
<em>Triangulation of my face with midway shape</em></p>

<p><img src="images/face_morphing/theo_warped_midway.jpg" alt="My face warped to midway shape" /><br />
<em>My face warped to midway shape</em></p>

<p><img src="images/face_morphing/magnus_tri.PNG" alt="Triangulation of Magnus's face with original shape" /><br />
<em>Triangulation of Magnus’s face with original shape</em></p>

<p><img src="images/face_morphing/magnus_avg_tri.PNG" alt="Triangulation of Magnus's face with midway shape" /><br />
<em>Triangulation of Magnus’s face with midway shape</em></p>

<p><img src="images/face_morphing/magnus_warped_midway.jpg" alt="Magnus's face warped to midway shape" /><br />
<em>Magnus’s face warped to midway shape</em></p>

<p><img src="images/face_morphing/theo_magnus_midway.jpg" alt="Mid-way Face (after cross-dissolving)" /><br />
<em>Mid-way Face (after cross-dissolving)</em></p>

<h3 id="part-3-the-morph-sequence">Part 3: The Morph Sequence</h3>

<p>Now that we have an idea of how to morph between the two faces, to produce a gradual sequence that morphs between my face and Magnus’s, we simply need to vary the parameters of the morph and apply the same procedure we used in Part 2. Namely, the two parameters we’re concerned with are <code class="language-plaintext highlighter-rouge">warp_frac</code> (controls how much of my face shape is warped into Magnus’s face shape) and <code class="language-plaintext highlighter-rouge">dissolve_frac</code> (controls how much my face colors are changed into Magnus’s face colors). For the midway face, both of these parameters were 0.5 because we wanted an equal contribution from both faces. To produce a morph sequence, we vary these parameters from 0 to 1 and create 50 frames of gradual morphing from my face to Magnus’s. For each frame, I compute the shape to warp to as <code class="language-plaintext highlighter-rouge">(1-warp_frac)*theo_pts + warp_frac*magnus_pts</code> and warp both faces to this shape. Then, I cross-dissolve by computing a weighted average of the pixel values of these warped images, i.e., <code class="language-plaintext highlighter-rouge">(1-dissolve_frac)*warped_theo + dissolve_frac*warped_magnus</code>. The morph sequence can be seen as a GIF below:</p>

<p><img src="images/face_morphing/theo_to_magnus.gif" alt="Morphing Sequence from my face to Magnus's" /><br />
<em>Morphing Sequence from my face to Magnus’s</em></p>

<h3 id="part-4-the-mean-face-of-a-population">Part 4: The “Mean Face” of a Population</h3>

<p>I also computed the mean face of a subset of the <a href="https://web.archive.org/web/20210305094647/http://www2.imm.dtu.dk/~aam/datasets/datasets.html">Danes dataset</a> by first finding the average face shape (averaging the face vectors), warping each image to the average shape, and finally averaging the pixels of these warped images. The subset I used was the frontal face, neutral expression subset. I used the annotated face shapes provided in the dataset but added additional points to each shape corresponding to the corners of each image. The average face can be seen below. Since most of the dataset contained male faces, it makes sense that the average face also looks male.</p>

<p><img src="images/face_morphing/dane_faces.JPG" alt="Subset of Danes Population (full frontal, neutral expression)" /><br />
<em>Subset of Danes Population (full frontal, neutral expression)</em></p>

<p><img src="images/face_morphing/avg_dane_face_tri.JPG" alt="Triangulation on Average Danes' Shape" /><br />
<em>Triangulation on Average Danes’ Shape</em></p>

<p><img src="images/face_morphing/average_dane_face.jpg" alt="Average Face of Danes Population" /><br />
<em>Average Face of Danes Population</em></p>

<p>Here are the faces of the population morphed to the average shape with some specific examples:</p>

<p><img src="images/face_morphing/danes_warped.JPG" alt="Danes Population Morphed to Average shape" /><br />
<em>Danes Population Morphed to Average shape</em></p>

<p><img src="images/face_morphing/dane1.jpg" alt="Original image" /><br />
<em>Original image</em></p>

<p><img src="images/face_morphing/dane1_warped.jpg" alt="Image Warped to Average Shape" /><br />
<em>Image Warped to Average Shape</em></p>

<p><img src="images/face_morphing/dane2.jpg" alt="Original Image" /><br />
<em>Original Image</em></p>

<p><img src="images/face_morphing/dane2_warped.jpg" alt="Image Warped to Average Shape" /><br />
<em>Image Warped to Average Shape</em></p>

<p>I took another picture of my face to match the pattern in the Danes dataset, full frontal and neutral expression. Then, I morphed my face into the average Danes shape and the average Danes face into my face shape, the results of which can be seen below:</p>

<p><img src="images/face_morphing/theop.jpg" alt="My Face (full frontal, neutral expression)" /><br />
<em>My Face (full frontal, neutral expression)</em></p>

<p><img src="images/face_morphing/theop_to_avg.jpg" alt="My face warped to average Danes' geometry" /><br />
<em>My face warped to average Danes’ geometry</em></p>

<p><img src="images/face_morphing/avg_to_theop.jpg" alt="Average Danes' Face warped into my geometry" /><br />
<em>Average Danes’ Face warped into my geometry</em></p>

<h3 id="part-5-caricatures---extrapolating-from-the-mean">Part 5: Caricatures - Extrapolating from the Mean</h3>

<p>To produce a caricature of myself, I extrapolated from the population mean found in the previous part. If <strong>a</strong> is the shape vector for the average face of the Danes and <strong>b</strong> is the shape vector for my face, then <strong>b-a</strong> represents what makes my shape different from the average Danes shape. So, we can add <strong>alpha(b-a)</strong> (where alpha is a positive constant) to my face shape to get an extrapolated face shape. Warping my face to this shape then produces a caricature of myself.</p>

<p><img src="images/face_morphing/theop_caricature.jpg" alt="Caricature of my face extrapolated from Danes population with alpha=1" /><br />
<em>Caricature of my face extrapolated from Danes population with alpha=1</em></p>

<h3 id="bells--whistles">Bells &amp; Whistles</h3>

<p>I changed the gender of my face by morphing with the face of an average European woman (image found <a href="https://learnopencv.com/average-face-opencv-c-python-tutorial/">here</a>). After defining correspondence points between the two faces, I warped just my face shape to the woman’s face shape. Then, I morphed my appearance to the woman’s appearance by first warping the woman’s face shape to mine and cross-dissolving the colors. Finally, I morphed both the shape and the appearance of my face to the woman’s by morphing with <code class="language-plaintext highlighter-rouge">warp_frac = 0.75</code> and <code class="language-plaintext highlighter-rouge">dissolve_frac = 0.75</code>. This placed more emphasis on the woman’s face than mine. The results of all three steps can be seen below:</p>

<p><img src="images/face_morphing/woman.jpg" alt="Average European Woman's Face" /><br />
<em>Average European Woman’s Face</em></p>

<p><img src="images/face_morphing/theop_to_woman_geo.jpg" alt="My face warped to woman's geometry" /><br />
<em>My face warped to woman’s geometry</em></p>

<p><img src="images/face_morphing/theop_to_woman_appearance.jpg" alt="My face morphed to woman's appearance" /><br />
<em>My face morphed to woman’s appearance</em></p>

<p><img src="images/face_morphing/theop_to_woman.jpg" alt="My face morphed to both woman's geometry and appearance" /><br />
<em>My face morphed to both woman’s geometry and appearance</em></p>

<h3 id="reflection">Reflection</h3>

<p>This project was fun and it was interesting to see the different uses of morphing, especially since it is widely used in animated movies, as well as the “aging” or “youthening” effects seen in movies. Through this project, I also learned about some of the computational issues that come with morphing like choosing points to properly correspond between two images and the trade-off between quality and speed when it comes to warping.</p>

</div>
  </main>
  <footer class="mt-auto py-3 text-center">

  <small class="text-muted mb-2">
    <i class="fas fa-code"></i> with <i class="fas fa-heart"></i>
    by <strong>Theo Pedapolu</strong>
  </small>

  <div class="container-fluid justify-content-center"><a class="social mx-1"  href="mailto:theopedapolu@gmail.com"
       style="color: #6c757d"
       onMouseOver="this.style.color='#db4437'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fas fa-envelope fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.github.com/theopedapolu"
       style="color: #6c757d"
       onMouseOver="this.style.color='#333333'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-github fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.linkedin.com/in/theopedapolu/"
       style="color: #6c757d"
       onMouseOver="this.style.color='#007bb5'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-linkedin-in fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.twitter.com/TPedapolu"
       style="color: #6c757d"
       onMouseOver="this.style.color='#1da1f2'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-twitter fa-1x"></i>
    </a>

</div><small id="attribution">
    theme <a href="https://github.com/YoussefRaafatNasry/portfolYOU">portfolYOU</a>
  </small>

</footer>

  
  <!-- GitHub Buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>

<!-- Bootstrap JS CDN -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- wow.js CDN & Activation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.js"></script>
<script> new WOW().init(); </script>

<!-- Initialize all tooltips -->
<script>
$(function () {
    $('[data-toggle="tooltip"]').tooltip()
})
</script>
</body>

</html>